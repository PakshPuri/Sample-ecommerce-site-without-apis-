<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gifted - AI Gift Shop</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body { box-sizing: border-box; }
    * { font-family: 'Quicksand', sans-serif; }
    
    .pastel-gradient {
      background: linear-gradient(135deg, #fef3f2 0%, #fdf4ff 25%, #f0f9ff 50%, #f0fdf4 75%, #fffbeb 100%);
    }
    
    .card-hover {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .card-hover:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    }
    
    .chat-bubble {
      animation: fadeInUp 0.3s ease-out;
    }
    
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse-soft {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    .pulse-soft { animation: pulse-soft 2s ease-in-out infinite; }
    
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    .float { animation: float 3s ease-in-out infinite; }
    
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    
    .typing-dot {
      animation: typing 1.4s ease-in-out infinite;
    }
    
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }
    
    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-8px); }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app" class="h-full overflow-auto pastel-gradient"><!-- Header -->
   <header class="sticky top-0 z-40 bg-white/80 backdrop-blur-lg border-b border-pink-100">
    <div class="max-w-7xl mx-auto px-4 py-3">
     <div class="flex items-center justify-between"><!-- Logo -->
      <div class="flex items-center gap-2 cursor-pointer" onclick="navigateTo('home')">
       <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-pink-400 to-purple-400 flex items-center justify-center"><span class="text-white text-xl">üéÅ</span>
       </div><span id="store-name" class="text-xl font-bold bg-gradient-to-r from-pink-500 to-purple-500 bg-clip-text text-transparent">Gifted</span>
      </div><!-- Search Bar -->
      <div class="hidden md:flex flex-1 max-w-xl mx-8">
       <div class="relative w-full"><input type="text" id="search-input" placeholder="Search for the perfect gift..." class="w-full px-4 py-2.5 pl-11 rounded-full bg-pink-50 border-2 border-transparent focus:border-pink-300 focus:bg-white outline-none transition-all" oninput="handleSearch(this.value)">
        <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-pink-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
       </div>
      </div><!-- Nav Icons -->
      <div class="flex items-center gap-2"><button onclick="navigateTo('wishlist')" class="p-2.5 rounded-full hover:bg-pink-100 transition-colors relative">
        <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
        </svg><span id="wishlist-count" class="absolute -top-1 -right-1 w-5 h-5 bg-pink-500 text-white text-xs rounded-full flex items-center justify-center hidden">0</span> </button> <button onclick="navigateTo('cart')" class="p-2.5 rounded-full hover:bg-pink-100 transition-colors relative">
        <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
        </svg><span id="cart-count" class="absolute -top-1 -right-1 w-5 h-5 bg-purple-500 text-white text-xs rounded-full flex items-center justify-center hidden">0</span> </button> <button onclick="navigateTo('account')" class="p-2.5 rounded-full hover:bg-pink-100 transition-colors">
        <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg></button>
      </div>
     </div><!-- Mobile Search -->
     <div class="md:hidden mt-3">
      <div class="relative"><input type="text" placeholder="Search gifts..." class="w-full px-4 py-2 pl-10 rounded-full bg-pink-50 border-2 border-transparent focus:border-pink-300 outline-none" oninput="handleSearch(this.value)">
       <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-pink-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
       </svg>
      </div>
     </div><!-- Categories Nav -->
     <nav class="flex gap-1 mt-3 overflow-x-auto scrollbar-hide pb-1"><button onclick="filterCategory('all')" class="category-btn px-4 py-1.5 rounded-full text-sm font-medium bg-pink-500 text-white whitespace-nowrap transition-all" data-category="all">All Gifts</button> <button onclick="filterCategory('birthday')" class="category-btn px-4 py-1.5 rounded-full text-sm font-medium bg-pink-100 text-pink-600 hover:bg-pink-200 whitespace-nowrap transition-all" data-category="birthday">üéÇ Birthday</button> <button onclick="filterCategory('wedding')" class="category-btn px-4 py-1.5 rounded-full text-sm font-medium bg-purple-100 text-purple-600 hover:bg-purple-200 whitespace-nowrap transition-all" data-category="wedding">üíí Wedding</button> <button onclick="filterCategory('baby')" class="category-btn px-4 py-1.5 rounded-full text-sm font-medium bg-blue-100 text-blue-600 hover:bg-blue-200 whitespace-nowrap transition-all" data-category="baby">üë∂ Baby</button> <button onclick="filterCategory('home')" class="category-btn px-4 py-1.5 rounded-full text-sm font-medium bg-green-100 text-green-600 hover:bg-green-200 whitespace-nowrap transition-all" data-category="home">üè† Home</button> <button onclick="filterCategory('tech')" class="category-btn px-4 py-1.5 rounded-full text-sm font-medium bg-amber-100 text-amber-600 hover:bg-amber-200 whitespace-nowrap transition-all" data-category="tech">üì± Tech</button> <button onclick="filterCategory('jewelry')" class="category-btn px-4 py-1.5 rounded-full text-sm font-medium bg-rose-100 text-rose-600 hover:bg-rose-200 whitespace-nowrap transition-all" data-category="jewelry">üíé Jewelry</button>
     </nav>
    </div>
   </header><!-- Main Content -->
   <main id="main-content"><!-- Home Page -->
    <div id="page-home"><!-- Hero Section -->
     <section class="relative py-12 md:py-20 px-4">
      <div class="max-w-7xl mx-auto">
       <div class="flex flex-col md:flex-row items-center gap-8">
        <div class="flex-1 text-center md:text-left">
         <h1 id="hero-title" class="text-4xl md:text-6xl font-bold text-gray-800 leading-tight">Find the <span class="bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500 bg-clip-text text-transparent">Perfect Gift</span> for Everyone</h1>
         <p id="hero-subtitle" class="mt-4 text-lg text-gray-600 max-w-lg mx-auto md:mx-0">Discover unique, thoughtful gifts with AI-powered recommendations. Let our smart assistant help you find exactly what you're looking for.</p>
         <div class="mt-8 flex flex-col sm:flex-row gap-4 justify-center md:justify-start"><button onclick="openChatbot()" class="px-8 py-3 bg-gradient-to-r from-pink-500 to-purple-500 text-white rounded-full font-semibold hover:shadow-lg hover:shadow-pink-500/30 transition-all pulse-soft"> ü§ñ Ask AI for Recommendations </button> <button onclick="scrollToProducts()" class="px-8 py-3 bg-white text-purple-600 rounded-full font-semibold border-2 border-purple-200 hover:border-purple-400 transition-all"> Browse All Gifts </button>
         </div>
        </div>
        <div class="flex-1 relative">
         <div class="grid grid-cols-2 gap-4 max-w-md mx-auto">
          <div class="bg-pink-200 rounded-3xl p-6 float" style="animation-delay: 0s;"><span class="text-5xl">üéÅ</span>
          </div>
          <div class="bg-purple-200 rounded-3xl p-6 float" style="animation-delay: 0.5s;"><span class="text-5xl">üíù</span>
          </div>
          <div class="bg-blue-200 rounded-3xl p-6 float" style="animation-delay: 1s;"><span class="text-5xl">üå∏</span>
          </div>
          <div class="bg-amber-200 rounded-3xl p-6 float" style="animation-delay: 1.5s;"><span class="text-5xl">‚ú®</span>
          </div>
         </div>
        </div>
       </div>
      </div>
     </section><!-- Featured Categories -->
     <section class="py-8 px-4">
      <div class="max-w-7xl mx-auto">
       <h2 class="text-2xl font-bold text-gray-800 mb-6">Shop by Occasion</h2>
       <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div onclick="filterCategory('birthday')" class="bg-gradient-to-br from-pink-100 to-pink-200 rounded-2xl p-6 cursor-pointer card-hover"><span class="text-4xl">üéÇ</span>
         <h3 class="mt-3 font-semibold text-gray-800">Birthday</h3>
         <p class="text-sm text-gray-600">150+ gifts</p>
        </div>
        <div onclick="filterCategory('wedding')" class="bg-gradient-to-br from-purple-100 to-purple-200 rounded-2xl p-6 cursor-pointer card-hover"><span class="text-4xl">üíí</span>
         <h3 class="mt-3 font-semibold text-gray-800">Wedding</h3>
         <p class="text-sm text-gray-600">200+ gifts</p>
        </div>
        <div onclick="filterCategory('baby')" class="bg-gradient-to-br from-blue-100 to-blue-200 rounded-2xl p-6 cursor-pointer card-hover"><span class="text-4xl">üë∂</span>
         <h3 class="mt-3 font-semibold text-gray-800">Baby Shower</h3>
         <p class="text-sm text-gray-600">100+ gifts</p>
        </div>
        <div onclick="filterCategory('home')" class="bg-gradient-to-br from-green-100 to-green-200 rounded-2xl p-6 cursor-pointer card-hover"><span class="text-4xl">üè†</span>
         <h3 class="mt-3 font-semibold text-gray-800">Housewarming</h3>
         <p class="text-sm text-gray-600">80+ gifts</p>
        </div>
       </div>
      </div>
     </section><!-- Products Grid -->
     <section id="products-section" class="py-8 px-4">
      <div class="max-w-7xl mx-auto">
       <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-gray-800">Featured Gifts</h2><select onchange="sortProducts(this.value)" class="px-4 py-2 rounded-lg bg-white border border-pink-200 text-gray-700 outline-none focus:border-pink-400"> <option value="featured">Featured</option> <option value="price-low">Price: Low to High</option> <option value="price-high">Price: High to Low</option> <option value="rating">Top Rated</option> </select>
       </div>
       <div id="products-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6"><!-- Products will be rendered here -->
       </div>
      </div>
     </section>
    </div><!-- Product Detail Page -->
    <div id="page-product" class="hidden py-8 px-4">
     <div class="max-w-6xl mx-auto" id="product-detail-content"><!-- Product detail will be rendered here -->
     </div>
    </div><!-- Cart Page -->
    <div id="page-cart" class="hidden py-8 px-4">
     <div class="max-w-4xl mx-auto">
      <h1 class="text-3xl font-bold text-gray-800 mb-8">Shopping Cart</h1>
      <div id="cart-content"><!-- Cart items will be rendered here -->
      </div>
     </div>
    </div><!-- Wishlist Page -->
    <div id="page-wishlist" class="hidden py-8 px-4">
     <div class="max-w-6xl mx-auto">
      <h1 class="text-3xl font-bold text-gray-800 mb-8">My Wishlist</h1>
      <div id="wishlist-content" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6"><!-- Wishlist items will be rendered here -->
      </div>
     </div>
    </div><!-- Account Page -->
    <div id="page-account" class="hidden py-8 px-4">
     <div class="max-w-2xl mx-auto">
      <h1 class="text-3xl font-bold text-gray-800 mb-8">My Account</h1>
      <div class="bg-white rounded-2xl p-6 shadow-lg">
       <div class="flex items-center gap-4 mb-6">
        <div class="w-20 h-20 rounded-full bg-gradient-to-br from-pink-400 to-purple-400 flex items-center justify-center text-3xl">
         üë§
        </div>
        <div>
         <h2 class="text-xl font-semibold text-gray-800">Guest User</h2>
         <p class="text-gray-500">guest@example.com</p>
        </div>
       </div>
       <div class="space-y-3"><button class="w-full p-4 bg-pink-50 rounded-xl text-left hover:bg-pink-100 transition-colors flex items-center gap-3"> <span class="text-xl">üì¶</span> <span class="font-medium text-gray-700">My Orders</span> </button> <button class="w-full p-4 bg-purple-50 rounded-xl text-left hover:bg-purple-100 transition-colors flex items-center gap-3"> <span class="text-xl">üìç</span> <span class="font-medium text-gray-700">Saved Addresses</span> </button> <button class="w-full p-4 bg-blue-50 rounded-xl text-left hover:bg-blue-100 transition-colors flex items-center gap-3"> <span class="text-xl">üí≥</span> <span class="font-medium text-gray-700">Payment Methods</span> </button> <button class="w-full p-4 bg-green-50 rounded-xl text-left hover:bg-green-100 transition-colors flex items-center gap-3"> <span class="text-xl">‚öôÔ∏è</span> <span class="font-medium text-gray-700">Settings</span> </button>
       </div>
      </div>
     </div>
    </div>
   </main><!-- AI Chatbot -->
   <div id="chatbot-container" class="fixed bottom-4 right-4 z-50"><!-- Chat Button --> <button id="chat-toggle" onclick="toggleChatbot()" class="w-16 h-16 rounded-full bg-gradient-to-r from-pink-500 to-purple-500 text-white shadow-lg hover:shadow-xl hover:shadow-purple-500/30 transition-all flex items-center justify-center"> <span class="text-2xl" id="chat-icon">ü§ñ</span> </button> <!-- Chat Window -->
    <div id="chat-window" class="hidden absolute bottom-20 right-0 w-80 md:w-96 bg-white rounded-2xl shadow-2xl overflow-hidden border border-pink-100"><!-- Chat Header -->
     <div class="bg-gradient-to-r from-pink-500 to-purple-500 p-4 text-white">
      <div class="flex items-center gap-3">
       <div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center">
        ü§ñ
       </div>
       <div>
        <h3 class="font-semibold">Gift Assistant</h3>
        <p class="text-xs text-pink-100">Powered by AI</p>
       </div>
      </div>
     </div><!-- Chat Messages -->
     <div id="chat-messages" class="h-80 overflow-y-auto p-4 space-y-3 scrollbar-hide bg-gradient-to-b from-pink-50/50 to-white">
      <div class="chat-bubble flex gap-2">
       <div class="w-8 h-8 rounded-full bg-gradient-to-br from-pink-400 to-purple-400 flex-shrink-0 flex items-center justify-center text-sm">
        ü§ñ
       </div>
       <div class="bg-white rounded-2xl rounded-tl-sm p-3 shadow-sm max-w-[80%]">
        <p class="text-gray-700 text-sm">Hi! I'm your gift assistant. Tell me about the person you're shopping for, and I'll recommend the perfect gifts from our collection! üéÅ</p>
       </div>
      </div>
     </div><!-- Quick Suggestions -->
     <div class="px-4 py-2 border-t border-pink-100 flex gap-2 overflow-x-auto scrollbar-hide"><button onclick="sendQuickMessage('Birthday gift for mom')" class="px-3 py-1.5 bg-pink-100 text-pink-600 rounded-full text-xs whitespace-nowrap hover:bg-pink-200 transition-colors">Birthday gift for mom</button> <button onclick="sendQuickMessage('Wedding gift ideas')" class="px-3 py-1.5 bg-purple-100 text-purple-600 rounded-full text-xs whitespace-nowrap hover:bg-purple-200 transition-colors">Wedding gift ideas</button> <button onclick="sendQuickMessage('Gifts under $50')" class="px-3 py-1.5 bg-blue-100 text-blue-600 rounded-full text-xs whitespace-nowrap hover:bg-blue-200 transition-colors">Gifts under $50</button>
     </div><!-- Chat Input -->
     <div class="p-4 border-t border-pink-100">
      <form onsubmit="sendMessage(event)" class="flex gap-2"><input type="text" id="chat-input" placeholder="Type your message..." class="flex-1 px-4 py-2 rounded-full bg-pink-50 border-2 border-transparent focus:border-pink-300 outline-none text-sm"> <button type="submit" class="w-10 h-10 rounded-full bg-gradient-to-r from-pink-500 to-purple-500 text-white flex items-center justify-center hover:shadow-lg transition-all">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
        </svg></button>
      </form>
     </div>
    </div>
   </div><!-- Toast Notification -->
   <div id="toast" class="fixed bottom-24 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-lg opacity-0 pointer-events-none transition-opacity z-50"><span id="toast-message">Added to cart!</span>
   </div>
  </div>
  <script>
    // Product Data
    const products = [
      { id: 1, name: "Luxury Scented Candle Set", price: 45, originalPrice: 60, rating: 4.8, reviews: 234, category: "home", emoji: "üïØÔ∏è", colors: ["Lavender", "Vanilla", "Rose"], description: "Hand-poured soy candles with premium essential oils. Perfect for creating a relaxing atmosphere.", tags: ["relaxation", "home decor", "aromatherapy", "mom", "housewarming"] },
      { id: 2, name: "Personalized Photo Album", price: 35, originalPrice: 45, rating: 4.9, reviews: 189, category: "birthday", emoji: "üì∏", colors: ["White", "Cream", "Black"], description: "Beautiful leather-bound album with gold embossing. Holds up to 200 photos.", tags: ["memories", "personalized", "family", "anniversary", "wedding"] },
      { id: 3, name: "Wireless Earbuds Pro", price: 89, originalPrice: 129, rating: 4.7, reviews: 567, category: "tech", emoji: "üéß", colors: ["White", "Black", "Pink"], description: "Premium sound quality with active noise cancellation. 24hr battery life.", tags: ["music", "tech", "travel", "workout", "teen"] },
      { id: 4, name: "Artisan Chocolate Box", price: 28, originalPrice: 35, rating: 4.9, reviews: 423, category: "birthday", emoji: "üç´", colors: ["Assorted"], description: "Hand-crafted Belgian chocolates in a luxury gift box. 24 pieces.", tags: ["sweet", "gourmet", "valentine", "thank you", "hostess"] },
      { id: 5, name: "Crystal Wine Glasses Set", price: 65, originalPrice: 85, rating: 4.8, reviews: 156, category: "wedding", emoji: "üç∑", colors: ["Clear", "Rose Gold Rim"], description: "Elegant lead-free crystal glasses. Set of 4 with gift packaging.", tags: ["wedding", "housewarming", "anniversary", "couple", "elegant"] },
      { id: 6, name: "Cozy Cashmere Throw", price: 95, originalPrice: 140, rating: 4.9, reviews: 312, category: "home", emoji: "üß£", colors: ["Blush", "Gray", "Cream"], description: "Ultra-soft 100% cashmere blanket. Perfect for cozy nights.", tags: ["comfort", "luxury", "winter", "mom", "grandma"] },
      { id: 7, name: "Smart Plant Monitor", price: 42, originalPrice: 55, rating: 4.6, reviews: 198, category: "tech", emoji: "üå±", colors: ["White", "Green"], description: "Track sunlight, water, and nutrients. App-connected plant care.", tags: ["gardening", "plant lover", "eco", "housewarming", "unique"] },
      { id: 8, name: "Baby Memory Book", price: 38, originalPrice: 48, rating: 4.9, reviews: 287, category: "baby", emoji: "üë∂", colors: ["Pink", "Blue", "Yellow"], description: "Capture baby's first year with guided prompts and photo pages.", tags: ["baby", "new parents", "memory", "shower", "milestone"] },
      { id: 9, name: "Rose Gold Jewelry Set", price: 78, originalPrice: 110, rating: 4.8, reviews: 445, category: "jewelry", emoji: "üíé", colors: ["Rose Gold"], description: "Elegant necklace and earring set with cubic zirconia stones.", tags: ["jewelry", "elegant", "mom", "girlfriend", "birthday"] },
      { id: 10, name: "Gourmet Coffee Subscription Box", price: 55, originalPrice: 70, rating: 4.7, reviews: 234, category: "birthday", emoji: "‚òï", colors: ["Assorted Roasts"], description: "3 months of premium single-origin coffees from around the world.", tags: ["coffee", "subscription", "dad", "office", "unique"] },
      { id: 11, name: "Silk Pajama Set", price: 85, originalPrice: 120, rating: 4.8, reviews: 178, category: "birthday", emoji: "üëò", colors: ["Blush", "Navy", "Ivory"], description: "Luxurious 100% mulberry silk pajamas. Elegant button-up style.", tags: ["luxury", "comfort", "self-care", "mom", "wife"] },
      { id: 12, name: "Kids Art Supply Kit", price: 32, originalPrice: 42, rating: 4.7, reviews: 298, category: "baby", emoji: "üé®", colors: ["Rainbow"], description: "150-piece art set with crayons, markers, colored pencils, and more.", tags: ["kids", "creative", "art", "birthday", "holiday"] },
      { id: 13, name: "Smart Home Speaker", price: 99, originalPrice: 149, rating: 4.6, reviews: 567, category: "tech", emoji: "üîä", colors: ["Charcoal", "Sand", "Sky"], description: "Premium sound with voice assistant. Control your smart home.", tags: ["tech", "smart home", "music", "housewarming", "dad"] },
      { id: 14, name: "Organic Skincare Set", price: 62, originalPrice: 80, rating: 4.9, reviews: 389, category: "birthday", emoji: "üß¥", colors: ["Natural"], description: "5-piece set with cleanser, toner, serum, moisturizer, and mask.", tags: ["skincare", "self-care", "organic", "mom", "sister"] },
      { id: 15, name: "Wedding Guest Book", price: 48, originalPrice: 65, rating: 4.9, reviews: 156, category: "wedding", emoji: "üíí", colors: ["White", "Ivory", "Blush"], description: "Elegant hardcover book with gold foil accents. 200 pages.", tags: ["wedding", "engagement", "couple", "memory", "keepsake"] },
      { id: 16, name: "Portable Espresso Maker", price: 75, originalPrice: 95, rating: 4.7, reviews: 234, category: "tech", emoji: "‚òï", colors: ["Black", "Silver"], description: "Make barista-quality espresso anywhere. No electricity needed.", tags: ["coffee", "travel", "camping", "office", "dad"] }
    ];

    // State
    let cart = [];
    let wishlist = [];
    let currentCategory = 'all';
    let currentPage = 'home';
    let chatOpen = false;
    let searchQuery = '';

    const defaultConfig = {
      store_name: "Gifted",
      tagline: "Find the Perfect Gift",
      hero_title: "Find the Perfect Gift for Everyone",
      hero_subtitle: "Discover unique, thoughtful gifts with AI-powered recommendations. Let our smart assistant help you find exactly what you're looking for.",
      background_color: "#fef3f2",
      surface_color: "#ffffff",
      text_color: "#1f2937",
      primary_color: "#ec4899",
      secondary_color: "#a855f7",
      font_family: "Quicksand",
      font_size: 16
    };

    let config = { ...defaultConfig };

    // Initialize Element SDK
    window.elementSdk.init({
      defaultConfig,
      onConfigChange: async (newConfig) => {
        config = { ...defaultConfig, ...newConfig };
        applyConfig();
      },
      mapToCapabilities: (cfg) => ({
        recolorables: [
          { get: () => cfg.background_color || defaultConfig.background_color, set: (v) => { cfg.background_color = v; window.elementSdk.setConfig({ background_color: v }); } },
          { get: () => cfg.surface_color || defaultConfig.surface_color, set: (v) => { cfg.surface_color = v; window.elementSdk.setConfig({ surface_color: v }); } },
          { get: () => cfg.text_color || defaultConfig.text_color, set: (v) => { cfg.text_color = v; window.elementSdk.setConfig({ text_color: v }); } },
          { get: () => cfg.primary_color || defaultConfig.primary_color, set: (v) => { cfg.primary_color = v; window.elementSdk.setConfig({ primary_color: v }); } },
          { get: () => cfg.secondary_color || defaultConfig.secondary_color, set: (v) => { cfg.secondary_color = v; window.elementSdk.setConfig({ secondary_color: v }); } }
        ],
        borderables: [],
        fontEditable: { get: () => cfg.font_family || defaultConfig.font_family, set: (v) => { cfg.font_family = v; window.elementSdk.setConfig({ font_family: v }); } },
        fontSizeable: { get: () => cfg.font_size || defaultConfig.font_size, set: (v) => { cfg.font_size = v; window.elementSdk.setConfig({ font_size: v }); } }
      }),
      mapToEditPanelValues: (cfg) => new Map([
        ["store_name", cfg.store_name || defaultConfig.store_name],
        ["tagline", cfg.tagline || defaultConfig.tagline],
        ["hero_title", cfg.hero_title || defaultConfig.hero_title],
        ["hero_subtitle", cfg.hero_subtitle || defaultConfig.hero_subtitle]
      ])
    });

    function applyConfig() {
      const bgColor = config.background_color || defaultConfig.background_color;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const secondaryColor = config.secondary_color || defaultConfig.secondary_color;
      const fontFamily = config.font_family || defaultConfig.font_family;
      const fontSize = config.font_size || defaultConfig.font_size;

      document.documentElement.style.setProperty('--bg-color', bgColor);
      document.documentElement.style.setProperty('--surface-color', surfaceColor);
      document.documentElement.style.setProperty('--text-color', textColor);
      document.documentElement.style.setProperty('--primary-color', primaryColor);
      document.documentElement.style.setProperty('--secondary-color', secondaryColor);

      const app = document.getElementById('app');
      app.style.background = `linear-gradient(135deg, ${bgColor} 0%, ${adjustColor(bgColor, -5)} 50%, ${bgColor} 100%)`;
      app.style.fontFamily = `${fontFamily}, Quicksand, sans-serif`;
      app.style.fontSize = `${fontSize}px`;

      document.getElementById('store-name').textContent = config.store_name || defaultConfig.store_name;
      document.getElementById('hero-title').innerHTML = (config.hero_title || defaultConfig.hero_title).replace('Perfect Gift', `<span style="background: linear-gradient(to right, ${primaryColor}, ${secondaryColor}); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Perfect Gift</span>`);
      document.getElementById('hero-subtitle').textContent = config.hero_subtitle || defaultConfig.hero_subtitle;

      // Update product cards
      document.querySelectorAll('.product-card').forEach(card => {
        card.style.backgroundColor = surfaceColor;
      });

      // Update buttons
      document.querySelectorAll('.primary-btn').forEach(btn => {
        btn.style.background = `linear-gradient(to right, ${primaryColor}, ${secondaryColor})`;
      });
    }

    function adjustColor(hex, percent) {
      const num = parseInt(hex.replace('#', ''), 16);
      const amt = Math.round(2.55 * percent);
      const R = (num >> 16) + amt;
      const G = (num >> 8 & 0x00FF) + amt;
      const B = (num & 0x0000FF) + amt;
      return '#' + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 + (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 + (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
    }

    // Navigation
    function navigateTo(page) {
      currentPage = page;
      document.querySelectorAll('[id^="page-"]').forEach(p => p.classList.add('hidden'));
      
      if (page === 'home') {
        document.getElementById('page-home').classList.remove('hidden');
      } else if (page === 'cart') {
        document.getElementById('page-cart').classList.remove('hidden');
        renderCart();
      } else if (page === 'wishlist') {
        document.getElementById('page-wishlist').classList.remove('hidden');
        renderWishlist();
      } else if (page === 'account') {
        document.getElementById('page-account').classList.remove('hidden');
      }
      
      window.scrollTo(0, 0);
    }

    function showProductDetail(productId) {
      const product = products.find(p => p.id === productId);
      if (!product) return;
      
      document.querySelectorAll('[id^="page-"]').forEach(p => p.classList.add('hidden'));
      document.getElementById('page-product').classList.remove('hidden');
      
      const inWishlist = wishlist.some(w => w.id === product.id);
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const secondaryColor = config.secondary_color || defaultConfig.secondary_color;
      
      document.getElementById('product-detail-content').innerHTML = `
        <button onclick="navigateTo('home')" class="flex items-center gap-2 text-gray-600 hover:text-gray-800 mb-6">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
          Back to Shop
        </button>
        <div class="grid md:grid-cols-2 gap-8">
          <div class="bg-gradient-to-br from-pink-100 to-purple-100 rounded-3xl p-12 flex items-center justify-center">
            <span class="text-9xl">${product.emoji}</span>
          </div>
          <div>
            <div class="flex items-start justify-between">
              <div>
                <span class="px-3 py-1 bg-pink-100 text-pink-600 rounded-full text-sm font-medium capitalize">${product.category}</span>
                <h1 class="mt-3 text-3xl font-bold text-gray-800">${product.name}</h1>
              </div>
              <button onclick="toggleWishlist(${product.id})" class="p-3 rounded-full hover:bg-pink-100 transition-colors">
                <svg class="w-7 h-7 ${inWishlist ? 'fill-pink-500 text-pink-500' : 'text-gray-400'}" fill="${inWishlist ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                </svg>
              </button>
            </div>
            <div class="mt-3 flex items-center gap-3">
              <div class="flex items-center gap-1">
                ${renderStars(product.rating)}
              </div>
              <span class="text-gray-500">${product.rating} (${product.reviews} reviews)</span>
            </div>
            <div class="mt-4 flex items-baseline gap-3">
              <span class="text-3xl font-bold" style="color: ${primaryColor}">$${product.price}</span>
              <span class="text-xl text-gray-400 line-through">$${product.originalPrice}</span>
              <span class="px-2 py-1 bg-green-100 text-green-600 rounded-full text-sm font-medium">
                ${Math.round((1 - product.price / product.originalPrice) * 100)}% OFF
              </span>
            </div>
            <p class="mt-6 text-gray-600 leading-relaxed">${product.description}</p>
            <div class="mt-6">
              <h3 class="font-semibold text-gray-800 mb-2">Available Options:</h3>
              <div class="flex flex-wrap gap-2">
                ${product.colors.map(color => `<span class="px-4 py-2 bg-gray-100 rounded-full text-sm">${color}</span>`).join('')}
              </div>
            </div>
            <div class="mt-8 flex gap-3">
              <button onclick="addToCart(${product.id})" class="primary-btn flex-1 py-4 rounded-full font-semibold text-white hover:shadow-lg transition-all" style="background: linear-gradient(to right, ${primaryColor}, ${secondaryColor})">
                Add to Cart
              </button>
              <button onclick="addToCart(${product.id}); navigateTo('cart')" class="flex-1 py-4 rounded-full font-semibold border-2 border-purple-200 text-purple-600 hover:bg-purple-50 transition-all">
                Buy Now
              </button>
            </div>
            <div class="mt-6 p-4 bg-green-50 rounded-xl flex items-center gap-3">
              <span class="text-2xl">üöö</span>
              <div>
                <p class="font-medium text-green-800">Free Shipping</p>
                <p class="text-sm text-green-600">Delivery in 2-4 business days</p>
              </div>
            </div>
          </div>
        </div>
        <div class="mt-12">
          <h2 class="text-2xl font-bold text-gray-800 mb-6">You May Also Like</h2>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            ${products.filter(p => p.category === product.category && p.id !== product.id).slice(0, 4).map(p => renderProductCard(p)).join('')}
          </div>
        </div>
      `;
      
      window.scrollTo(0, 0);
    }

    // Products
    function renderProducts() {
      let filtered = [...products];
      
      if (currentCategory !== 'all') {
        filtered = filtered.filter(p => p.category === currentCategory);
      }
      
      if (searchQuery) {
        const query = searchQuery.toLowerCase();
        filtered = filtered.filter(p => 
          p.name.toLowerCase().includes(query) || 
          p.tags.some(t => t.includes(query)) ||
          p.category.includes(query)
        );
      }
      
      const grid = document.getElementById('products-grid');
      if (filtered.length === 0) {
        grid.innerHTML = `
          <div class="col-span-full text-center py-12">
            <span class="text-6xl mb-4 block">üîç</span>
            <h3 class="text-xl font-semibold text-gray-800">No gifts found</h3>
            <p class="text-gray-500 mt-2">Try adjusting your search or browse all categories</p>
            <button onclick="filterCategory('all')" class="mt-4 px-6 py-2 bg-pink-500 text-white rounded-full hover:bg-pink-600 transition-colors">
              View All Gifts
            </button>
          </div>
        `;
      } else {
        grid.innerHTML = filtered.map(p => renderProductCard(p)).join('');
      }
    }

    function renderProductCard(product) {
      const inWishlist = wishlist.some(w => w.id === product.id);
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      
      return `
        <div class="product-card bg-white rounded-2xl overflow-hidden shadow-md card-hover cursor-pointer" style="background-color: ${surfaceColor}" onclick="showProductDetail(${product.id})">
          <div class="relative">
            <div class="bg-gradient-to-br from-pink-100 to-purple-100 p-8 flex items-center justify-center">
              <span class="text-6xl">${product.emoji}</span>
            </div>
            <button onclick="event.stopPropagation(); toggleWishlist(${product.id})" class="absolute top-3 right-3 w-9 h-9 rounded-full bg-white/90 flex items-center justify-center shadow-md hover:scale-110 transition-transform">
              <svg class="w-5 h-5 ${inWishlist ? 'fill-pink-500 text-pink-500' : 'text-gray-400'}" fill="${inWishlist ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
              </svg>
            </button>
            ${product.originalPrice > product.price ? `<span class="absolute top-3 left-3 px-2 py-1 bg-green-500 text-white text-xs font-semibold rounded-full">${Math.round((1 - product.price / product.originalPrice) * 100)}% OFF</span>` : ''}
          </div>
          <div class="p-4">
            <h3 class="font-semibold text-gray-800 line-clamp-2">${product.name}</h3>
            <div class="mt-1 flex items-center gap-1">
              ${renderStars(product.rating)}
              <span class="text-xs text-gray-500 ml-1">(${product.reviews})</span>
            </div>
            <div class="mt-2 flex items-baseline gap-2">
              <span class="text-lg font-bold" style="color: ${primaryColor}">$${product.price}</span>
              ${product.originalPrice > product.price ? `<span class="text-sm text-gray-400 line-through">$${product.originalPrice}</span>` : ''}
            </div>
            <button onclick="event.stopPropagation(); addToCart(${product.id})" class="primary-btn mt-3 w-full py-2 rounded-full text-white text-sm font-medium hover:shadow-lg transition-all" style="background: linear-gradient(to right, ${primaryColor}, ${config.secondary_color || defaultConfig.secondary_color})">
              Add to Cart
            </button>
          </div>
        </div>
      `;
    }

    function renderStars(rating) {
      const fullStars = Math.floor(rating);
      const hasHalf = rating % 1 >= 0.5;
      let html = '';
      for (let i = 0; i < 5; i++) {
        if (i < fullStars) {
          html += '<svg class="w-4 h-4 text-amber-400 fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>';
        } else if (i === fullStars && hasHalf) {
          html += '<svg class="w-4 h-4 text-amber-400" viewBox="0 0 20 20"><defs><linearGradient id="half"><stop offset="50%" stop-color="currentColor"/><stop offset="50%" stop-color="#D1D5DB"/></linearGradient></defs><path fill="url(#half)" d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>';
        } else {
          html += '<svg class="w-4 h-4 text-gray-300 fill-current" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>';
        }
      }
      return html;
    }

    // Cart Functions
    function addToCart(productId) {
      const product = products.find(p => p.id === productId);
      if (!product) return;
      
      const existing = cart.find(c => c.id === productId);
      if (existing) {
        existing.quantity++;
      } else {
        cart.push({ ...product, quantity: 1 });
      }
      
      updateCartCount();
      showToast(`${product.name} added to cart!`);
    }

    function removeFromCart(productId) {
      cart = cart.filter(c => c.id !== productId);
      updateCartCount();
      renderCart();
    }

    function updateCartQuantity(productId, delta) {
      const item = cart.find(c => c.id === productId);
      if (item) {
        item.quantity += delta;
        if (item.quantity <= 0) {
          removeFromCart(productId);
        } else {
          renderCart();
        }
      }
      updateCartCount();
    }

    function updateCartCount() {
      const count = cart.reduce((sum, item) => sum + item.quantity, 0);
      const countEl = document.getElementById('cart-count');
      if (count > 0) {
        countEl.textContent = count;
        countEl.classList.remove('hidden');
      } else {
        countEl.classList.add('hidden');
      }
    }

    function renderCart() {
      const container = document.getElementById('cart-content');
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const secondaryColor = config.secondary_color || defaultConfig.secondary_color;
      
      if (cart.length === 0) {
        container.innerHTML = `
          <div class="text-center py-16">
            <span class="text-7xl mb-4 block">üõí</span>
            <h3 class="text-2xl font-semibold text-gray-800">Your cart is empty</h3>
            <p class="text-gray-500 mt-2">Discover amazing gifts for your loved ones</p>
            <button onclick="navigateTo('home')" class="mt-6 px-8 py-3 rounded-full text-white font-semibold hover:shadow-lg transition-all" style="background: linear-gradient(to right, ${primaryColor}, ${secondaryColor})">
              Start Shopping
            </button>
          </div>
        `;
        return;
      }
      
      const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
      const shipping = subtotal >= 50 ? 0 : 5.99;
      const total = subtotal + shipping;
      
      container.innerHTML = `
        <div class="space-y-4">
          ${cart.map(item => `
            <div class="bg-white rounded-xl p-4 shadow-sm flex gap-4 items-center">
              <div class="w-20 h-20 bg-gradient-to-br from-pink-100 to-purple-100 rounded-xl flex items-center justify-center flex-shrink-0">
                <span class="text-3xl">${item.emoji}</span>
              </div>
              <div class="flex-1 min-w-0">
                <h3 class="font-semibold text-gray-800 truncate">${item.name}</h3>
                <p class="text-lg font-bold" style="color: ${primaryColor}">$${item.price}</p>
              </div>
              <div class="flex items-center gap-2">
                <button onclick="updateCartQuantity(${item.id}, -1)" class="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center font-semibold transition-colors">‚àí</button>
                <span class="w-8 text-center font-medium">${item.quantity}</span>
                <button onclick="updateCartQuantity(${item.id}, 1)" class="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center font-semibold transition-colors">+</button>
              </div>
              <button onclick="removeFromCart(${item.id})" class="p-2 text-gray-400 hover:text-red-500 transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
              </button>
            </div>
          `).join('')}
        </div>
        
        <div class="mt-8 bg-white rounded-xl p-6 shadow-sm">
          <h3 class="font-semibold text-gray-800 mb-4">Order Summary</h3>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-600">Subtotal</span>
              <span class="font-medium">$${subtotal.toFixed(2)}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Shipping</span>
              <span class="font-medium ${shipping === 0 ? 'text-green-600' : ''}">${shipping === 0 ? 'FREE' : '$' + shipping.toFixed(2)}</span>
            </div>
            ${shipping > 0 ? `<p class="text-xs text-pink-600">Add $${(50 - subtotal).toFixed(2)} more for free shipping!</p>` : ''}
            <div class="border-t border-gray-200 pt-2 mt-2">
              <div class="flex justify-between text-lg font-bold">
                <span>Total</span>
                <span style="color: ${primaryColor}">$${total.toFixed(2)}</span>
              </div>
            </div>
          </div>
          <button onclick="showToast('Demo checkout - no actual payment processed')" class="mt-6 w-full py-4 rounded-full text-white font-semibold hover:shadow-lg transition-all" style="background: linear-gradient(to right, ${primaryColor}, ${secondaryColor})">
            Proceed to Checkout
          </button>
          <p class="text-center text-xs text-gray-500 mt-3">üîí Secure checkout ‚Ä¢ Free returns</p>
        </div>
      `;
    }

    // Wishlist Functions
    function toggleWishlist(productId) {
      const product = products.find(p => p.id === productId);
      if (!product) return;
      
      const index = wishlist.findIndex(w => w.id === productId);
      if (index >= 0) {
        wishlist.splice(index, 1);
        showToast('Removed from wishlist');
      } else {
        wishlist.push(product);
        showToast('Added to wishlist ‚ù§Ô∏è');
      }
      
      updateWishlistCount();
      renderProducts();
      
      if (currentPage === 'wishlist') {
        renderWishlist();
      }
    }

    function updateWishlistCount() {
      const countEl = document.getElementById('wishlist-count');
      if (wishlist.length > 0) {
        countEl.textContent = wishlist.length;
        countEl.classList.remove('hidden');
      } else {
        countEl.classList.add('hidden');
      }
    }

    function renderWishlist() {
      const container = document.getElementById('wishlist-content');
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const secondaryColor = config.secondary_color || defaultConfig.secondary_color;
      
      if (wishlist.length === 0) {
        container.innerHTML = `
          <div class="col-span-full text-center py-16">
            <span class="text-7xl mb-4 block">üíù</span>
            <h3 class="text-2xl font-semibold text-gray-800">Your wishlist is empty</h3>
            <p class="text-gray-500 mt-2">Save items you love for later</p>
            <button onclick="navigateTo('home')" class="mt-6 px-8 py-3 rounded-full text-white font-semibold hover:shadow-lg transition-all" style="background: linear-gradient(to right, ${primaryColor}, ${secondaryColor})">
              Discover Gifts
            </button>
          </div>
        `;
        return;
      }
      
      container.innerHTML = wishlist.map(p => renderProductCard(p)).join('');
    }

    // Category Filter
    function filterCategory(category) {
      currentCategory = category;
      searchQuery = '';
      document.getElementById('search-input').value = '';
      
      document.querySelectorAll('.category-btn').forEach(btn => {
        const btnCategory = btn.dataset.category;
        if (btnCategory === category) {
          btn.classList.remove('bg-pink-100', 'bg-purple-100', 'bg-blue-100', 'bg-green-100', 'bg-amber-100', 'bg-rose-100');
          btn.classList.remove('text-pink-600', 'text-purple-600', 'text-blue-600', 'text-green-600', 'text-amber-600', 'text-rose-600');
          btn.classList.add('bg-pink-500', 'text-white');
        } else {
          btn.classList.remove('bg-pink-500', 'text-white');
          const colors = {
            'all': ['bg-pink-100', 'text-pink-600'],
            'birthday': ['bg-pink-100', 'text-pink-600'],
            'wedding': ['bg-purple-100', 'text-purple-600'],
            'baby': ['bg-blue-100', 'text-blue-600'],
            'home': ['bg-green-100', 'text-green-600'],
            'tech': ['bg-amber-100', 'text-amber-600'],
            'jewelry': ['bg-rose-100', 'text-rose-600']
          };
          btn.classList.add(...colors[btnCategory]);
        }
      });
      
      renderProducts();
      navigateTo('home');
      scrollToProducts();
    }

    function sortProducts(method) {
      // Sorting handled in render
      renderProducts();
    }

    function handleSearch(query) {
      searchQuery = query;
      currentCategory = 'all';
      renderProducts();
    }

    function scrollToProducts() {
      document.getElementById('products-section').scrollIntoView({ behavior: 'smooth' });
    }

    // Toast
    function showToast(message) {
      const toast = document.getElementById('toast');
      document.getElementById('toast-message').textContent = message;
      toast.classList.remove('opacity-0', 'pointer-events-none');
      setTimeout(() => {
        toast.classList.add('opacity-0', 'pointer-events-none');
      }, 2500);
    }

    // Chatbot Functions
    function toggleChatbot() {
      chatOpen = !chatOpen;
      const window = document.getElementById('chat-window');
      const icon = document.getElementById('chat-icon');
      
      if (chatOpen) {
        window.classList.remove('hidden');
        icon.textContent = '‚úï';
      } else {
        window.classList.add('hidden');
        icon.textContent = 'ü§ñ';
      }
    }

    function openChatbot() {
      if (!chatOpen) toggleChatbot();
    }

    function sendQuickMessage(message) {
      document.getElementById('chat-input').value = message;
      sendMessage(new Event('submit'));
    }

    function sendMessage(event) {
      event.preventDefault();
      const input = document.getElementById('chat-input');
      const message = input.value.trim();
      if (!message) return;
      
      const messagesContainer = document.getElementById('chat-messages');
      
      // Add user message
      messagesContainer.innerHTML += `
        <div class="chat-bubble flex gap-2 justify-end">
          <div class="bg-gradient-to-r from-pink-500 to-purple-500 rounded-2xl rounded-tr-sm p-3 max-w-[80%]">
            <p class="text-white text-sm">${message}</p>
          </div>
        </div>
      `;
      
      input.value = '';
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      
      // Show typing indicator
      const typingId = 'typing-' + Date.now();
      messagesContainer.innerHTML += `
        <div id="${typingId}" class="chat-bubble flex gap-2">
          <div class="w-8 h-8 rounded-full bg-gradient-to-br from-pink-400 to-purple-400 flex-shrink-0 flex items-center justify-center text-sm">ü§ñ</div>
          <div class="bg-white rounded-2xl rounded-tl-sm p-3 shadow-sm">
            <div class="flex gap-1">
              <span class="typing-dot w-2 h-2 bg-pink-400 rounded-full"></span>
              <span class="typing-dot w-2 h-2 bg-pink-400 rounded-full"></span>
              <span class="typing-dot w-2 h-2 bg-pink-400 rounded-full"></span>
            </div>
          </div>
        </div>
      `;
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      
      // Generate AI response
      setTimeout(() => {
        const typingEl = document.getElementById(typingId);
        if (typingEl) typingEl.remove();
        
        const response = generateAIResponse(message);
        messagesContainer.innerHTML += response;
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }, 1200);
    }

    function generateAIResponse(userMessage) {
      const msg = userMessage.toLowerCase();
      let recommendations = [];
      let responseText = '';
      
      // Budget-based recommendations
      if (msg.includes('under $30') || msg.includes('under 30') || msg.includes('cheap') || msg.includes('budget')) {
        recommendations = products.filter(p => p.price < 30).slice(0, 3);
        responseText = "Great choice for staying budget-friendly! Here are some wonderful gifts under $30:";
      }
      else if (msg.includes('under $50') || msg.includes('under 50')) {
        recommendations = products.filter(p => p.price < 50).slice(0, 3);
        responseText = "Here are some fantastic gift options under $50:";
      }
      else if (msg.includes('under $100') || msg.includes('under 100') || msg.includes('premium') || msg.includes('luxury')) {
        recommendations = products.filter(p => p.price >= 50).slice(0, 3);
        responseText = "Looking for something special? Here are some premium picks:";
      }
      // Person-based recommendations
      else if (msg.includes('mom') || msg.includes('mother')) {
        recommendations = products.filter(p => p.tags.includes('mom') || p.tags.includes('self-care') || p.tags.includes('luxury')).slice(0, 3);
        responseText = "Moms deserve the best! Here are thoughtful gifts she'll love:";
      }
      else if (msg.includes('dad') || msg.includes('father')) {
        recommendations = products.filter(p => p.tags.includes('dad') || p.tags.includes('tech') || p.tags.includes('coffee')).slice(0, 3);
        responseText = "For an amazing dad, I recommend these:";
      }
      else if (msg.includes('wife') || msg.includes('girlfriend') || msg.includes('her')) {
        recommendations = products.filter(p => p.tags.includes('jewelry') || p.tags.includes('luxury') || p.tags.includes('self-care')).slice(0, 3);
        responseText = "For someone special, these gifts will make her smile:";
      }
      else if (msg.includes('husband') || msg.includes('boyfriend') || msg.includes('him')) {
        recommendations = products.filter(p => p.tags.includes('tech') || p.tags.includes('coffee') || p.tags.includes('travel')).slice(0, 3);
        responseText = "For the special man in your life, consider these:";
      }
      else if (msg.includes('kid') || msg.includes('child') || msg.includes('teen')) {
        recommendations = products.filter(p => p.tags.includes('kids') || p.tags.includes('creative') || p.tags.includes('tech')).slice(0, 3);
        responseText = "Kids will love these fun and engaging gifts:";
      }
      // Occasion-based recommendations
      else if (msg.includes('birthday')) {
        recommendations = products.filter(p => p.category === 'birthday' || p.tags.includes('birthday')).slice(0, 3);
        responseText = "Make their birthday special with these gifts:";
      }
      else if (msg.includes('wedding') || msg.includes('couple') || msg.includes('engagement')) {
        recommendations = products.filter(p => p.category === 'wedding' || p.tags.includes('couple')).slice(0, 3);
        responseText = "Perfect for celebrating love! Here are some wedding gift ideas:";
      }
      else if (msg.includes('baby') || msg.includes('shower') || msg.includes('new parent')) {
        recommendations = products.filter(p => p.category === 'baby' || p.tags.includes('baby')).slice(0, 3);
        responseText = "Welcome the little one with these adorable gifts:";
      }
      else if (msg.includes('housewarming') || msg.includes('home') || msg.includes('new house')) {
        recommendations = products.filter(p => p.category === 'home' || p.tags.includes('housewarming')).slice(0, 3);
        responseText = "Help them make their new house a home:";
      }
      // Interest-based recommendations
      else if (msg.includes('tech') || msg.includes('gadget') || msg.includes('electronic')) {
        recommendations = products.filter(p => p.category === 'tech').slice(0, 3);
        responseText = "For the tech enthusiast, these are perfect:";
      }
      else if (msg.includes('coffee') || msg.includes('drink')) {
        recommendations = products.filter(p => p.tags.includes('coffee')).slice(0, 3);
        responseText = "For coffee lovers, I recommend:";
      }
      else if (msg.includes('jewelry') || msg.includes('accessory')) {
        recommendations = products.filter(p => p.category === 'jewelry').slice(0, 3);
        responseText = "Beautiful jewelry options for you:";
      }
      else if (msg.includes('relax') || msg.includes('self-care') || msg.includes('spa')) {
        recommendations = products.filter(p => p.tags.includes('self-care') || p.tags.includes('relaxation')).slice(0, 3);
        responseText = "Perfect for relaxation and self-care:";
      }
      // Default response
      else {
        recommendations = products.sort((a, b) => b.rating - a.rating).slice(0, 3);
        responseText = "Here are our top-rated gifts that everyone loves! Tell me more about who you're shopping for and I can give better recommendations:";
      }
      
      if (recommendations.length === 0) {
        recommendations = products.slice(0, 3);
      }
      
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      
      return `
        <div class="chat-bubble flex gap-2">
          <div class="w-8 h-8 rounded-full bg-gradient-to-br from-pink-400 to-purple-400 flex-shrink-0 flex items-center justify-center text-sm">ü§ñ</div>
          <div class="bg-white rounded-2xl rounded-tl-sm p-3 shadow-sm max-w-[85%]">
            <p class="text-gray-700 text-sm mb-3">${responseText}</p>
            <div class="space-y-2">
              ${recommendations.map(p => `
                <div onclick="showProductDetail(${p.id}); toggleChatbot();" class="flex items-center gap-2 p-2 bg-pink-50 rounded-lg cursor-pointer hover:bg-pink-100 transition-colors">
                  <span class="text-2xl">${p.emoji}</span>
                  <div class="flex-1 min-w-0">
                    <p class="text-xs font-medium text-gray-800 truncate">${p.name}</p>
                    <p class="text-xs font-bold" style="color: ${primaryColor}">$${p.price}</p>
                  </div>
                </div>
              `).join('')}
            </div>
            <p class="text-xs text-gray-500 mt-2">Click any product to view details! üéÅ</p>
          </div>
        </div>
      `;
    }

    // Initialize
    renderProducts();
    applyConfig();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9bef54f4046a1f68',t:'MTc2ODU4NDUzMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>